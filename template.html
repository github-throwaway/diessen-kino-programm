<!DOCTYPE html>
<html lang="de">
<head>
    <title>Kinoprogramm Die√üen</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <link href="css/styles.css" rel="stylesheet">
</head>
<body>
<div class="container">
    <h1>üé¨ Kinoprogramm Die√üen</h1>

    <a id="calendar-link" href="movies.ics" class="calendar-btn">
        <i class="fas fa-calendar-plus"></i> Kalender abonnieren
    </a>
    <br>
    <br>
    <div><h5>Link f√ºr manuellen Import</h5></div>
    <div class="url-copy-container">
        <input type="text" id="ics-url" readonly>
        <button id="copy-btn">
            <i class="fas fa-copy"></i>
        </button>
    </div>

    <div class="copy-notification" id="copy-notification">
        Link in Zwischenablage kopiert!
    </div>

    <div class="last-updated">
        Zuletzt aktualisiert: {{LAST_UPDATED}}
    </div>
</div>


<script>
    // Function to detect Android
    function isAndroid() {
        return /Android/i.test(navigator.userAgent);
    }

    // Function to get base URL from the current page
    function getBaseUrl() {
        const currentUrl = window.location.href;
        return currentUrl
            .replace(/^https?:\/\//, '') // Remove 'https://' or 'http://'
            .replace(/\/$/, '');          // Remove trailing slash
    }

    // Function to generate the ICS URL
    function getIcsUrl(baseUrl) {
        return 'https://' + baseUrl + '/movies.ics';
    }

    // Function to generate the calendar link based on platform
    function getCalendarLink(baseUrl) {
        const calendarUrl = baseUrl + '/movies.ics';
        if (isAndroid()) {
            // For Android, use Google Calendar URL
            return 'https://calendar.google.com/calendar/u/0/r?cid=webcal://' + calendarUrl;
        } else {
            // For iOS/Mac, use webcal protocol
            return 'webcal://' + calendarUrl;
        }
    }

    // Get the base URL
    const baseUrl = getBaseUrl();

    // Set ICS URL in the input field
    document.getElementById('ics-url').value = getIcsUrl(baseUrl);

    // Get the calendar link element and update the href
    const calendarLink = document.getElementById('calendar-link');
    calendarLink.href = getCalendarLink(baseUrl);

    // Copy to clipboard functionality
    document.getElementById('copy-btn').addEventListener('click', function () {
        const input = document.getElementById('ics-url');
        input.select();
        navigator.clipboard.writeText(input.value)
            .then(() => {
                const notification = document.getElementById('copy-notification');
                notification.classList.add('show');
                setTimeout(() => notification.classList.remove('show'), 2000);
            })
            .catch(err => console.error('Fehler beim Kopieren:', err));
    });
</script>
</body>
</html>